# ドメインモデル実装計画書 - Unit1: タスク作成機能

## 作成情報

- **作成日**: 2025-10-22
- **対象**: Unit1 タスク作成機能のソースコード実装
- **参照**: `docs/inception/03-domain-model/unit1/result/` 内の全設計書
- **実装方式**: ドメイン駆動設計（DDD）に基づく 4 層アーキテクチャ

## 必須質問事項

### 技術要素の確定

**[質問]** ドメインモデル設計からソースコードを作成する上で、どの技術要素（プログラミング言語/フレームワーク）を使用しますか？

**[回答]**

- プログラミング言語：Python
- Web フレームワーク：FastAPI
- データベース：使用しない想定
- テストフレームワーク：不要
- その他の依存ライブラリ：お任せします

### テストコードの必要性について

**[質問]** ドメインモデル設計からソースコードを作成する上で、テストコードを作成する必要がありますか？

**[回答]**

- テストコード作成の必要：不要
- テストフレームワーク（テストコード作成の必要がある場合）：不要

## 実装計画ステップ

### フェーズ 1: 開発環境準備・技術基盤確立

#### ステップ 1-1: 技術要素確定・環境構築

- [ ] 開発環境のセットアップ
- [ ] プロジェクト構造の作成
- [ ] 依存関係・ライブラリの設定

**[質問]** 使用する IDE や開発ツールに特別な要求はありますか？
**[回答]** VSCode を使用する想定です

**[質問]** データベースは実際の DB サーバーを使用しますか、それともインメモリ実装でよろしいですか？
**[回答]** インメモリ実装です

#### ステップ 1-2: アーキテクチャ基盤実装

- [ ] プロジェクト層構造の作成（プレゼンテーション層、アプリケーション層、ドメイン層、インフラ層）
- [ ] 基底クラス・共通インターフェースの実装
- [ ] 例外クラス階層の実装

### フェーズ 2: ドメイン層実装

#### ステップ 2-1: 基礎ドメインオブジェクト実装（IU-1）

- [ ] 値オブジェクトの実装
  - [ ] TaskId（UUID 形式の識別子）
  - [ ] TaskName（100 文字制限、サニタイゼーション付き）
  - [ ] TaskStatus（列挙型ベース）
  - [ ] CreatedAt/UpdatedAt（日時値オブジェクト）
- [ ] Task エンティティの実装
  - [ ] 集約ルートとしての Task 実装
  - [ ] 不変条件（INV-001 ～ INV-005）の実装
  - [ ] ビジネス不変条件（BIV-001 ～ BIV-003）の実装
  - [ ] 等価性・ハッシュ値の実装
- [ ] ドメインイベントの実装
  - [ ] TaskCreatedEvent 実装
  - [ ] イベントメタデータの実装

**[質問]** 値オブジェクトでのバリデーション失敗時の例外処理方針はどのようにしますか？
**[回答]** お任せします

#### ステップ 2-2: ドメインサービス実装（IU-2, IU-3）

- [ ] TaskCreationDomainService の実装
  - [ ] createNewTask()メソッド
  - [ ] ビジネスルール統合処理
  - [ ] TaskCreationResult 生成
- [ ] TaskValidationDomainService の実装
  - [ ] validateTaskCreation()メソッド
  - [ ] ビジネスルール実装（BR-001, BR-004, BR-005）
  - [ ] ValidationResult 生成
- [ ] TaskSecurityDomainService の実装
  - [ ] sanitizeTaskInput()メソッド
  - [ ] セキュリティ制約チェック
  - [ ] XSS・SQL インジェクション対策
- [ ] TaskFactory の実装
  - [ ] createTask()メソッド
  - [ ] デフォルト値適用ロジック

**[質問]** セキュリティサニタイゼーション処理で使用する外部ライブラリはありますか？
**[回答]** お任せします。

### フェーズ 3: アプリケーション層実装

#### ステップ 3-1: アプリケーションサービス実装（IU-4）

- [ ] TaskCreationApplicationService の実装
  - [ ] createTask()メソッド
  - [ ] トランザクション境界管理
  - [ ] 認証・認可統合
  - [ ] エラーハンドリング
- [ ] コマンド・レスポンスオブジェクト実装
  - [ ] CreateTaskCommand
  - [ ] CreateTaskResponse
  - [ ] CreateTaskErrorResponse
- [ ] アプリケーション例外処理の実装

**[質問]** 認証・認可機能は実装が必要ですか、それともモック実装でよろしいですか？
**[回答]** 不要です

**[質問]** トランザクション管理はどの範囲まで実装しますか？
**[回答]** お任せします。

### フェーズ 4: インフラストラクチャ層実装

#### ステップ 4-1: データアクセス層実装（IU-5）

- [ ] TaskRepository インターフェース実装
  - [ ] save()メソッド
  - [ ] findById()メソッド
  - [ ] exists()メソッド
- [ ] データベーススキーマ作成
  - [ ] tasks テーブル定義
  - [ ] インデックス・制約設定
- [ ] トランザクション管理実装
  - [ ] TransactionManager インターフェース実装
  - [ ] トランザクション境界制御

**[質問]** データベースマイグレーション機能は必要ですか？
**[回答]** 不要です

#### ステップ 4-2: イベント・外部連携実装

- [ ] EventPublisher インターフェース実装
  - [ ] publish()メソッド
  - [ ] 非同期イベント配信
- [ ] TaskDataConverter 実装
  - [ ] toTaskDataInterface()メソッド
  - [ ] Unit2 との連携データ形式対応
- [ ] 横断的関心事実装
  - [ ] Logger インターフェース実装
  - [ ] ConfigurationProvider インターフェース実装
  - [ ] MetricsCollector インターフェース実装

**[質問]** イベント配信は実際のメッセージブローカーを使用しますか、それともインメモリ実装でよろしいですか？
**[回答]** インメモリです

### フェーズ 5: プレゼンテーション層実装

#### ステップ 5-1: Web API 実装（IU-6）

- [ ] TaskCreationController の実装
  - [ ] POST /api/tasks エンドポイント
  - [ ] HTTP ステータスコード管理
  - [ ] CORS 設定
- [ ] DTO オブジェクト実装
  - [ ] CreateTaskRequestDTO
  - [ ] TaskResponseDTO
  - [ ] ErrorResponseDTO
- [ ] HTTP 例外ハンドリング実装

**[質問]** API 認証（JWT トークンなど）は実装が必要ですか？
**[回答]** 不要です

**[質問]** API 仕様書（OpenAPI/Swagger）の生成は必要ですか？
**[回答]** OpenAPI での仕様書

### フェーズ 6: テスト実装

#### ステップ 6-1: 単体テスト実装

- [ ] ドメインオブジェクトテスト
  - [ ] 値オブジェクトテスト（境界値テスト含む）
  - [ ] エンティティテスト（不変条件テスト含む）
- [ ] ドメインサービステスト
  - [ ] ビジネスルールテスト
  - [ ] セキュリティ機能テスト
- [ ] アプリケーションサービステスト
  - [ ] 正常系フローテスト
  - [ ] 異常系フローテスト

**[質問]** テストカバレッジの目標値はありますか？
**[回答]** テストは不要です

#### ステップ 6-2: 統合テスト実装（IU-7）

- [ ] データベース統合テスト
  - [ ] 実際の DB 接続テスト
  - [ ] トランザクションテスト
- [ ] イベント統合テスト
  - [ ] イベント発行・購読テスト
- [ ] E2E テスト
  - [ ] HTTP リクエストから永続化までの全工程テスト
  - [ ] 受け入れ基準（AC-001-01 ～ AC-002-03）テスト

### フェーズ 7: 最終統合・デプロイ準備

#### ステップ 7-1: システム統合・性能テスト

- [ ] 全機能統合テスト
- [ ] パフォーマンステスト
  - [ ] タスク作成処理時間（30 秒以内）確認
  - [ ] 成功率（95%以上）確認
- [ ] セキュリティテスト
  - [ ] XSS 攻撃テスト
  - [ ] SQL インジェクションテスト
  - [ ] 入力サニタイゼーションテスト

**[質問]** 負荷テストは実施が必要ですか？どの程度の負荷を想定しますか？
**[回答]** 不要です

#### ステップ 7-2: 運用準備・ドキュメント整備

- [ ] 運用監視機能実装
  - [ ] ヘルスチェック機能
  - [ ] メトリクス収集設定
  - [ ] ログ設定
- [ ] デプロイメント準備
  - [ ] 環境別設定管理
  - [ ] デプロイスクリプト作成
- [ ] ドキュメント整備
  - [ ] 運用手順書作成
  - [ ] トラブルシューティングガイド作成

**[質問]** コンテナ化（Docker）は必要ですか？
**[回答]** 不要です。ローカル環境で実行できれば大丈夫です

#### ステップ 7-3: Unit2 連携準備

- [ ] TaskDataInterface 仕様確認
- [ ] TaskCreatedEvent スキーマ確認
- [ ] 外部連携インターフェーステスト
- [ ] Unit2 チームとの結合テスト

**[質問]** Unit2 チームとの連携テスト環境はどのように準備しますか？
**[回答]** テスト環境の構築は不要です

## 実装時の重要注意事項

### 必須ビジネスルール

- **BR-001**: タスク名は必須項目である
- **BR-002**: タスク保存時には確認メッセージを表示する
- **BR-003**: バリデーションエラー時は操作を中断し、エラーメッセージを表示する
- **BR-004**: タスク名は 100 文字以内である
- **BR-005**: 特殊文字は適切にエスケープ処理される
- **BR-006**: 必須でない項目はデフォルト値または NULL で初期化される

### 実装品質基準

- [ ] コンパイルエラー・型エラーがない
- [ ] 単体テストカバレッジ 90%以上（ドメインロジック）
- [ ] 全受け入れ基準の実装・テスト完了
- [ ] セキュリティ要件の実装完了
- [ ] パフォーマンス要件の達成確認

### アーキテクチャ原則

- [ ] ドメイン層の純粋性維持（外部依存なし）
- [ ] 依存性逆転の原則遵守
- [ ] 単一責任の原則遵守
- [ ] インターフェース分離の原則遵守

## 完了条件

### 機能完了条件

- [ ] US-001（新しいタスクの追加）の全受け入れ基準実装完了
- [ ] US-002（タスクの基本情報入力）の全受け入れ基準実装完了
- [ ] 全ビジネスルール（BR-001 ～ BR-006）の実装完了

### 品質完了条件

- [ ] 全テストケースのパス
- [ ] セキュリティテストのパス
- [ ] パフォーマンステストのパス
- [ ] コードレビュー完了

### 連携完了条件

- [ ] Unit2 との連携インターフェース動作確認完了
- [ ] TaskCreatedEvent の正常配信確認完了
- [ ] TaskDataInterface 仕様準拠確認完了

## 想定工数・スケジュール

- **総想定工数**: 30 営業日（6 週間）
- **チーム構成**: 3-4 名
- **クリティカルパス**: フェーズ 1→2→3→4→5→6→7（順次実行）
- **並行実装可能**: ステップ 2-2 内の各ドメインサービス、ステップ 4-1 と 4-2

---

**実装開始前の最終確認**:

- [ ] 全質問事項への回答完了
- [ ] 技術要素の確定完了
- [ ] 開発環境準備完了
- [ ] チーム編成・役割分担確定完了
- [ ] Unit2 チームとの連携方法確定完了

**次回確認事項**:
本計画書の内容についてレビュー・承認をお願いいたします。承認後、計画に沿って段階的に実装を進めてまいります。
