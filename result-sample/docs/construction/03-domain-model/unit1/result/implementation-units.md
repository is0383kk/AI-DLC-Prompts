# 実装ユニット分割設計書 - Unit1: タスク作成機能

## 作成情報

- **作成日**: 2025-10-22
- **設計対象**: タスク作成機能の並行実装可能な作業ユニット分割
- **分析フェーズ**: フェーズ7（実装計画と作業分割）
- **参照元**: 全ドメインモデル設計書

## 1. 実装ユニット分割の方針

### 1.1 分割基準

```
【技術的独立性】
- 異なる技術層での並行開発可能性
- 依存関係の最小化
- インターフェース駆動開発の促進

【機能的独立性】
- 単一責任の原則に基づく分割
- テスト可能性の確保
- 段階的統合の可能性

【チーム割り当て適合性】
- 開発者のスキルセットとの適合
- 作業量の均等化
- コミュニケーションコストの最小化
```

### 1.2 依存関係マップ

```
┌─────────────────────────────────────────────────────────┐
│                    依存関係図                             │
└─────────────────────────────────────────────────────────┘

    IU-1 (Values & Entities)
            ↑
    IU-2 (Domain Services) ← IU-3 (Validation & Security)
            ↑                        ↑
    IU-4 (Application Services)      │
            ↑                        │
    IU-5 (Infrastructure) ←──────────┘
            ↑
    IU-6 (Presentation Layer)
            ↑
    IU-7 (Integration & Testing)

実装順序: IU-1 → IU-2&IU-3(並行) → IU-4 → IU-5 → IU-6 → IU-7
```

## 2. 実装ユニット詳細定義

### 2.1 IU-1: 基礎ドメインオブジェクト

```
【ユニット名】: 基礎ドメインオブジェクト（Foundation Domain Objects）
【担当者数】: 1名
【予想工数】: 3-4日
【技術領域】: ドメイン駆動設計、値オブジェクト、エンティティ

【実装対象】
■ 値オブジェクト
  - TaskId: UUID ベースの識別子
  - TaskName: バリデーション付きタスク名
  - TaskStatus: 列挙型ベースのステータス
  - CreatedAt/UpdatedAt: 日時値オブジェクト

■ エンティティ
  - Task: 集約ルートエンティティ
  - 不変条件の実装
  - 等価性・ハッシュ値の実装

■ ドメインイベント
  - TaskCreatedEvent: イベント基底クラス
  - イベントメタデータの実装

【成果物】
- Task.cs / Task.java / task.py (言語依存)
- ValueObjects/TaskId.cs
- ValueObjects/TaskName.cs
- ValueObjects/TaskStatus.cs
- ValueObjects/DateTime.cs
- Events/TaskCreatedEvent.cs
- 単体テストコード一式

【完了条件】
- すべての不変条件が実装され、テストされている
- 値オブジェクトのバリデーションが機能している
- エンティティの作成・更新が正常に動作している
- 100% のテストカバレッジ（ドメインロジック部分）

【注意事項】
- プログラミング言語の決定後に実装開始
- 他のユニットのインターフェース設計の基礎となる
- パフォーマンスよりも正確性を優先
```

### 2.2 IU-2: コアドメインサービス

```
【ユニット名】: コアドメインサービス（Core Domain Services）
【担当者数】: 1名
【予想工数】: 4-5日
【技術領域】: ドメインサービス、ファクトリパターン
【依存関係】: IU-1 の完了が必要

【実装対象】
■ TaskCreationDomainService
  - createNewTask() メソッド
  - ビジネスルール実装
  - エラーハンドリング

■ TaskFactory
  - タスクエンティティ生成
  - デフォルト値適用
  - 複雑な初期化処理

■ 集約管理
  - Task集約の境界制御
  - エンティティライフサイクル管理

【成果物】
- DomainServices/TaskCreationDomainService.cs
- Factories/TaskFactory.cs
- 単体テストコード
- ドメインサービス仕様書

【完了条件】
- すべてのビジネスルール（BR-001〜BR-006）が実装されている
- TaskFactory による複雑な作成パターンが機能している
- ドメインサービスの単体テストが完全である
- 例外処理が適切に実装されている

【注意事項】
- IU-3（バリデーション）との協調設計が必要
- モックを使用してIU-3の依存関係を管理
- ドメインロジックの純粋性を保つ
```

### 2.3 IU-3: バリデーション・セキュリティサービス

```
【ユニット名】: バリデーション・セキュリティサービス（Validation & Security Services）
【担当者数】: 1名
【予想工数】: 5-6日
【技術領域】: セキュリティ、バリデーション、サニタイゼーション
【依存関係】: IU-1 の完了が必要（IU-2 と並行実装可能）

【実装対象】
■ TaskValidationDomainService
  - 包括的バリデーション
  - ビジネスルール検証
  - 結果オブジェクト（ValidationResult）

■ TaskSecurityDomainService
  - 入力サニタイゼーション
  - セキュリティ制約チェック
  - XSS/SQLインジェクション対策

■ セキュリティ・バリデーション関連値オブジェクト
  - ValidationResult, ValidationViolation
  - SanitizedInput, SecurityCheckResult

【成果物】
- DomainServices/TaskValidationDomainService.cs
- DomainServices/TaskSecurityDomainService.cs
- ValueObjects/ValidationResult.cs
- ValueObjects/SecurityCheckResult.cs
- セキュリティテストスイート
- バリデーションルール仕様書

【完了条件】
- 全てのバリデーションルール（BR-001, BR-004, BR-005）が実装されている
- セキュリティテストが包括的に実装されている
- パフォーマンステスト（100ms以内）をクリアしている
- 悪意のある入力に対する防御が機能している

【注意事項】
- セキュリティライブラリとの統合
- 国際化対応のメッセージ設計
- パフォーマンスとセキュリティのバランス
```

### 2.4 IU-4: アプリケーションサービス

```
【ユニット名】: アプリケーションサービス（Application Services）
【担当者数】: 1名
【予想工数】: 4-5日
【技術領域】: アプリケーション層、CQRS、トランザクション管理
【依存関係】: IU-1, IU-2, IU-3 の完了が必要

【実装対象】
■ TaskCreationApplicationService
  - createTask() メソッド
  - トランザクション境界管理
  - 認証・認可統合

■ コマンド・クエリオブジェクト
  - CreateTaskCommand
  - CreateTaskResponse/CreateTaskErrorResponse

■ アプリケーション層例外
  - アプリケーション固有例外階層
  - エラーハンドリング戦略

【成果物】
- ApplicationServices/TaskCreationApplicationService.cs
- Commands/CreateTaskCommand.cs
- Responses/CreateTaskResponse.cs
- Responses/CreateTaskErrorResponse.cs
- 統合テストコード
- アプリケーションサービス仕様書

【完了条件】
- 全ての受け入れ基準（AC-001-01〜AC-002-03）が実装されている
- トランザクション制御が正しく機能している
- エラーハンドリングが適切に実装されている
- 認証・認可が正しく統合されている
- パフォーマンス要件（500ms以内）をクリアしている

【注意事項】
- インフラストラクチャ層のインターフェース定義が必要
- モック・スタブを使用した単体テスト
- 非同期処理の考慮（イベント発行）
```

### 2.5 IU-5: インフラストラクチャ層

```
【ユニット名】: インフラストラクチャ層（Infrastructure Layer）
【担当者数】: 2名（データアクセス1名、イベント・外部統合1名）
【予想工数】: 6-8日
【技術領域】: データアクセス、イベング、外部システム統合
【依存関係】: IU-1, IU-4 のインターフェース定義が必要

【実装対象】
■ データアクセス（担当者A）
  - TaskRepository 実装
  - データベーススキーマ設計・作成
  - トランザクション管理実装
  - コネクションプール設定

■ イベント・外部統合（担当者B）
  - EventPublisher 実装
  - イベントブローカー統合
  - TaskDataConverter 実装
  - 外部システムインターフェース

■ 横断的関心事
  - ログ出力機能（Logger）
  - 設定管理（ConfigurationProvider）
  - メトリクス収集（MetricsCollector）
  - セキュリティサービス実装

【成果物】
- Infrastructure/Repositories/TaskRepositoryImpl.cs
- Infrastructure/Events/EventPublisherImpl.cs
- Infrastructure/Converters/TaskDataConverter.cs
- Infrastructure/Logging/LoggerImpl.cs
- Infrastructure/Configuration/ConfigurationProviderImpl.cs
- Infrastructure/Security/SecurityServiceImpl.cs
- データベーススキーマ定義（DDL）
- インフラストラクチャテストコード

【完了条件】
- データベース操作が正常に機能している
- イベント発行・購読が動作している
- 外部システムとのデータ交換が機能している
- パフォーマンス要件をクリアしている
- 障害時の復旧機能が実装されている

【注意事項】
- データベース技術の選定が前提
- イベントブローカーの選定が前提
- 環境ごとの設定管理
- セキュリティ要件の厳格な実装
```

### 2.6 IU-6: プレゼンテーション層

```
【ユニット名】: プレゼンテーション層（Presentation Layer）
【担当者数】: 1名
【予想工数】: 3-4日
【技術領域】: Web API、HTTP、DTO、入力検証
【依存関係】: IU-4 の完了が必要

【実装対象】
■ Web API コントローラー
  - TaskCreationController
  - HTTP エンドポイント設計
  - HTTPステータスコード管理

■ DTO（Data Transfer Object）
  - CreateTaskRequestDTO
  - TaskResponseDTO
  - ErrorResponseDTO

■ HTTP レベルの処理
  - リクエスト/レスポンス変換
  - HTTPヘッダー管理
  - CORS設定

【成果物】
- Controllers/TaskCreationController.cs
- DTOs/CreateTaskRequestDTO.cs
- DTOs/TaskResponseDTO.cs
- DTOs/ErrorResponseDTO.cs
- API仕様書（OpenAPI/Swagger）
- E2Eテストコード

【完了条件】
- 全てのHTTPエンドポイントが動作している
- リクエスト/レスポンス変換が正しく機能している
- エラーハンドリングが適切に実装されている
- API仕様書が完成している
- セキュリティヘッダーが適切に設定されている

【注意事項】
- Web フレームワークの選定が前提
- API バージョニング戦略の考慮
- レート制限機能の実装
- 入力サイズ制限の実装
```

### 2.7 IU-7: 統合・テスト・運用

```
【ユニット名】: 統合・テスト・運用（Integration, Testing & Operations）
【担当者数】: 1-2名
【予想工数】: 5-7日
【技術領域】: 統合テスト、E2Eテスト、運用監視、デプロイメント
【依存関係】: IU-1〜IU-6 の全完了が必要

【実装対象】
■ 統合テスト
  - データベース統合テスト
  - イベント発行・購読テスト
  - エラーハンドリング統合テスト

■ E2E テスト
  - HTTPリクエストから永続化までの全工程テスト
  - パフォーマンステスト
  - 負荷テスト

■ 運用・監視機能
  - ヘルスチェック実装
  - メトリクス収集設定
  - ログ設定とローテーション
  - アラート設定

■ デプロイメント
  - 環境別設定
  - データベースマイグレーション
  - コンテナ化（Docker）
  - CI/CD パイプライン設定

【成果物】
- 統合テストスイート
- E2Eテストスイート
- パフォーマンステストスイート
- 運用手順書
- 監視設定ファイル
- デプロイメントスクリプト
- 環境構築手順書

【完了条件】
- 全ての統合テストがパスしている
- パフォーマンス要件をクリアしている
- 監視・アラートが正常に機能している
- デプロイメントが自動化されている
- 運用手順書が完備されている

【注意事項】
- 本番環境に近いテスト環境の構築
- 継続的インテグレーションの設定
- セキュリティテストの包括的実施
- 災害復旧テストの実施
```

## 3. 実装スケジュール

### 3.1 タイムライン（推奨）

```
【フェーズ1: 基盤構築】（Week 1）
Day 1-4:  IU-1 (基礎ドメインオブジェクト)
Day 5:    IU-1 レビュー・統合

【フェーズ2: ドメイン層完成】（Week 2）
Day 1-4:  IU-2 (コアドメインサービス) + IU-3 (バリデーション・セキュリティ) 並行
Day 5:    IU-2, IU-3 レビュー・統合

【フェーズ3: アプリケーション層】（Week 3）
Day 1-4:  IU-4 (アプリケーションサービス)
Day 5:    IU-4 レビュー・統合

【フェーズ4: インフラ・プレゼンテーション】（Week 4-5）
Day 1-6:  IU-5 (インフラストラクチャ層) - 2名並行
Day 7-10: IU-6 (プレゼンテーション層)

【フェーズ5: 統合・テスト】（Week 6）
Day 1-5:  IU-7 (統合・テスト・運用)
Day 6-7:  最終統合テスト・修正

合計期間: 6週間（30営業日）
```

### 3.2 クリティカルパス

```
【必須順序の依存関係】
IU-1 → IU-2 → IU-4 → IU-6 → IU-7 (部分)

【並行実装可能】
- IU-2 と IU-3（ドメインサービス）
- IU-5 内の2つのサブタスク（データアクセス・イベント）
- IU-7 の一部（IU-6完了後）

【リスク要因】
- データベース技術選定の遅延
- 外部システム（イベントブローカー）の設定複雑性
- セキュリティ要件の追加仕様
```

## 4. チーム編成推奨

### 4.1 スキルセット要件

```
【ドメイン駆動設計エキスパート】（IU-1, IU-2担当）
- DDD パターンの深い理解
- オブジェクト指向設計の経験
- 単体テスト設計の専門知識

【セキュリティエンジニア】（IU-3担当）
- Webアプリケーションセキュリティ
- バリデーション設計
- 脆弱性テスト経験

【アプリケーションアーキテクト】（IU-4担当）
- CQRS/イベントソーシング経験
- トランザクション設計
- 非同期処理設計

【インフラエンジニア】（IU-5担当）
- データベース設計・運用
- メッセージブローカー経験
- クラウドインフラ経験

【フロントエンドエンジニア】（IU-6担当）
- Web API 設計
- HTTP/REST の深い理解
- API ドキュメント作成

【DevOps エンジニア】（IU-7担当）
- CI/CD パイプライン構築
- 監視・アラート設定
- テスト自動化
```

### 4.2 コミュニケーション計画

```
【定期同期】
- 毎日: 15分スタンドアップ（進捗・ブロッカー確認）
- 週2回: 技術レビュー会（設計・実装品質確認）
- 週1回: 統合確認会（インターフェース整合性確認）

【マイルストーン】
- 各IU完了時: レビュー・承認プロセス
- フェーズ完了時: デモ・受け入れテスト
- 最終完了時: 本番デプロイメント準備確認

【ドキュメント共有】
- 設計書: リアルタイム更新・共有
- コードレビュー: プルリクエストベース
- 課題管理: チケットシステム活用
```

## 5. 品質保証戦略

### 5.1 各段階の品質ゲート

```
【IU完了時の品質基準】
✅ コードレビュー完了（2名以上）
✅ 単体テストカバレッジ90%以上
✅ 静的解析ツールエラー0件
✅ セキュリティスキャン合格
✅ パフォーマンステスト合格

【フェーズ完了時の品質基準】
✅ 統合テスト完了
✅ 受け入れ基準確認
✅ ドキュメント更新完了
✅ 次フェーズへの引き継ぎ完了

【全体完了時の品質基準】
✅ E2Eテスト完了
✅ パフォーマンス要件達成
✅ セキュリティ監査合格
✅ 運用手順書完備
```

### 5.2 継続的品質改善

```
【メトリクス収集】
- 開発効率: 工数実績 vs 予想
- 品質指標: バグ発見率、修正時間
- テストカバレッジ: 層別・機能別

【改善アクション】
- 週次レトロスペクティブ
- 品質メトリクスレビュー
- プロセス改善提案

【ナレッジ蓄積】
- 技術的学習事項の共有
- 設計判断の記録・共有
- 次回プロジェクトへの改善提案
```

## 6. リスク管理

### 6.1 技術リスク

```
【高リスク】
- データベース技術選定の遅延
  → 軽減策: 早期選定・プロトタイプ作成

- セキュリティ要件の変更
  → 軽減策: セキュリティ専門家の早期参画

- パフォーマンス要件未達
  → 軽減策: 早期パフォーマンステスト実施

【中リスク】
- 外部システム統合の複雑性
  → 軽減策: モックを活用した独立開発

- チーム間のインターフェース齟齬
  → 軽減策: 頻繁なコミュニケーション

【低リスク】
- 単体テストの作成遅延
  → 軽減策: TDD の導入
```

### 6.2 スケジュールリスク

```
【バッファ確保】
- 各フェーズに20%のバッファを設定
- クリティカルパスの特定と集中管理
- 並行作業の最大化

【早期警告システム】
- 週次進捗レビュー
- ブロッカーの即座エスカレーション
- 代替計画の事前準備
```

## 7. 成功指標・完了基準

### 7.1 機能要件の達成

```
✅ US-001: 新しいタスクの追加
  - AC-001-01: 正常なタスク作成 → 実装・テスト完了
  - AC-001-02: タスクの保存 → 実装・テスト完了
  - AC-001-03: 空白タスク名のバリデーション → 実装・テスト完了

✅ US-002: タスクの基本情報入力
  - AC-002-01: 最小限の入力でタスク作成 → 実装・テスト完了
  - AC-002-02: タスク名の文字数制限 → 実装・テスト完了
  - AC-002-03: 特殊文字の入力 → 実装・テスト完了
```

### 7.2 非機能要件の達成

```
✅ パフォーマンス要件
  - タスク作成成功率: 95%以上達成
  - タスク作成操作完了時間: 30秒以内達成
  - バリデーションエラーの適切な表示: 100%達成
  - データ永続化成功率: 100%達成

✅ セキュリティ要件
  - 入力サニタイゼーション: 全パターン対応
  - 認証・認可: 正常動作確認
  - ログ出力: 完全な監査証跡

✅ 運用要件
  - 監視・アラート: 設定完了
  - ヘルスチェック: 機能確認
  - デプロイメント: 自動化完了
```

### 7.3 品質要件の達成

```
✅ テストカバレッジ
  - 単体テスト: 90%以上
  - 統合テスト: 主要フロー100%
  - E2Eテスト: 全受け入れ基準100%

✅ ドキュメント
  - 設計書: 完備・最新化
  - 運用手順書: 完備・検証済み
  - API仕様書: 完備・検証済み

✅ 引き継ぎ準備
  - 他ユニット連携: インターフェース確定
  - 運用チーム引き継ぎ: 手順書・研修完了
  - 保守チーム引き継ぎ: コード・ドキュメント引き継ぎ完了
```

---

**実装開始に向けた最終確認事項**:
- [ ] プログラミング言語・フレームワークの確定
- [ ] 開発環境・ツールチェーンの整備
- [ ] チーム編成・役割分担の確定
- [ ] 外部システム（DB、イベントブローカー）の選定・環境準備
- [ ] 開発標準・コーディング規約の策定
- [ ] プロジェクト管理ツール・コミュニケーションツールの準備

**Unit2（タスク表示機能）への引き継ぎ準備完了**:
- TaskDataInterface 仕様確定
- TaskCreatedEvent スキーマ確定
- 外部システムインターフェース仕様確定